use std::marker::PhantomData;
use crate::lex::{Token, Value};

pub trait Expr<'a, R> {
  fn accept(&self, visitor: &mut dyn Visitor<'a, R>) -> R;
}

<% for expr in expressions %>
pub struct <%= expr.name %><'a, V> {
<%- for m in expr.members -%>
  pub <%= m.name %>: <%= m.type %>,  
<%- end -%>
  _phantom_data: PhantomData<&'a V>,
}

impl<'a, V> <%= expr.name %><'a, V> where V: 'a {
  pub fn new(
  <% for m in expr.members %>
    <%= m.name %>: <%= m.type %>,  
  <%- end -%>
  ) -> <%= expr.name %><'a, V> {
    <%= expr.name %> {
    <%- for m in expr.members -%>
      <%= m.name %>,  
    <%- end -%>
      _phantom_data: PhantomData,
    }
  }
} 

impl <'a, R> Expr<'a, R> for <%= expr.name %><'a, R> where R: 'a {
  fn accept(&self, visitor: &mut dyn Visitor<'a, R>) -> R {
    visitor.visit_<%= expr.name.underscore %>_expr(self)
  }
}
<% end %>

pub trait Visitor<'a, R> where R: 'a {
<% for expr in expressions %>
  fn visit_<%= expr.name.underscore %>_expr(&mut self, e: &<%= expr.name %><'a, R>) -> R;
<% end %>
}

